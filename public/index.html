<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Reports</title>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/4.0.0/firebaseui.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>

    <!-- Bootstrap Font Icon CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    
    <!-- fontawesome Icon CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

    <!-- google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@200;300&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>

    <!-- mine -->
    <link rel="shortcut icon" href="images/fh.ico">
    <link rel="stylesheet" href="styles.css"/>
    <!-- <script type="importmap">
      { "imports": {
          "firebase-app":   "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js",
          "firebase-auth":  "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js",
          "firestore":      "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"
      } }
    </script> -->
    <script type="module" src="index.js" defer></script>
  </head>
  <body style="font-family: 'Raleway', sans-serif;">
    <div id="app">

      <div class="wrapper" id="wrapper-signin" style="display: none;">
          <form class="form-signin" id="signinForm">
            <h2 class="form-signin-heading">Login</h2>              
            <div class="inner-addon left-addon">
              <label class="control-label">User name</label>
              <i class="bi bi-envelope"></i>
                <input type="text" value="" class="form-control" id="creds_id" placeholder="your user id" required="" autofocus=""/>
            </div>
            <div class="inner-addon left-addon">
                <label class="control-label">Password</label>
                <i class="bi bi-eye"></i>
                <input type="password" value="" class="form-control" id="creds_pwd" placeholder="your password" required="" autofocus=""/>
            </div>
              <a class="forgot-password" href="#">I forgot my password</a>
              <button class="btn btn-lg btn-primary btn-block" id="signin">Let me in!</button>
          </form>
          <p class="account-signup">Don't have an account? <a href="#">Sign up here</a>
      </div>
          
      <section id="sectionReports" style="display: none;">
        <div class="row" style="padding: 0px 0px 0px 0px; margin: 0px;">
          <div class="col-md-6 bi-list my-auto" style="font-size: 40px; font-weight: bolder; color:cornflowerblue;">
            Reports
          </div>
          <div class="col-md-3 my-auto">
            <button class="btn btn-lg btn-primary btn-block" id="signout">Sign out</button>
          </div>
        </div>
        
        <details id = "detailsTemplate" style="display: none;">
          <summary id="detailSummary">
          </summary>
          <!-- <img src="images/fhSnoezelen.png" class="rounded mx-auto d-block" alt="..." style="padding: 20px"> -->
          <div class="shadow p-0 mb-0 bg-white rounded" style="margin: 9px">

            <!-- turn off sending form for now -->
            <!-- method="POST" data-email="seanglover.spg@gmail.com" action="https://script.google.com/macros/s/AKfycbyABqfNw4SOsPGcPizonfN4s7V5mRTGcHB_p0LfPG3vq3Ir1aNI-4Iz6Zos0nfggFh72g/exec" onsubmit="formSubmitted()" -->
            
            <form class="gform pure-form pure-form-stacked" id="mainForm">
              <div class="row" style="padding: 6px 0px 0px 0px; margin: 0px;">
                <!-- business section -->
                <div class="col-md-3">
                  <!-- business_name -->
                  <label for="businessName" class="form-label" id="businessNameLabel">Business name</label>
                  <input type="text" class="form-control" name="businessName" id="businessName" value="" required="">
                </div>
                <div class="col-md-4">
                  <!-- purchase_order -->
                  <label for="purchaseOrder" class="form-label" id="purchaseOrderLabel">Purchase order</label>
                  <input type="text" class="form-control" name="purchaseOrder" id="purchaseOrder" value="" required="">
                  <div class="invalid-feedback">
                    Please provide a valid street.
                  </div>
                </div>
                <div class="col-lg-3 col-sm-6">
                  <!-- document_date -->
                  <label for="documentDate" class="form-label">Document date</label>
                  <div class="input-group">
                    <input id="documentDate" class="form-control" type="date" value="">
                  </div>
                </div>
              </div>
              <div class="row" style="padding: 6px 0px 0px 0px; margin: 0px;">
                <!-- address -->
                <div class="col-md-6">
                  <!-- street -->
                  <label for="addressStreet" class="form-label" id="addressStreetLabel">Street</label>
                  <input type="text" class="form-control" id="addressStreet" value="" required="">
                  <div class="invalid-feedback">
                    Please provide a valid street.
                  </div>
                </div>
                <div class="col-md-2">
                  <!-- city -->
                  <label for="addressCity" class="form-label" id="addressCityLabel">City</label>
                  <input type="text" class="form-control" id="addressCity" value="" required="">
                  <div class="invalid-feedback">
                    Please provide a valid city.
                  </div>
                </div>
                <div class="col-md-2">
                  <!-- provinces -->
                  <label for="provinces" class="form-label">Province</label>
                  <select class="form-select" id="provinces" value="Québec" required="" style="min-height: 45px;">
                    <option id="provincesLabel">Choose a province
                    </option><option id="AB" value="AB">Alberta
                    </option><option id="BC" value="BC">British Columbia
                    </option><option id="MB" value="MB">Manitoba
                    </option><option id="NB" value="NB">New Brunswick
                    </option><option id="NL" value="NL">Newfoundland and Labrador
                    </option><option id="NS" value="NS">Nova Scotia
                    </option><option id="NT" value="NT">Northwest Territories
                    </option><option id="NU" value="NU">Nunavut
                    </option><option id="ON" value="ON">Ontario
                    </option><option id="PE" value="PE">Prince Edward Island
                    </option><option id="QC" value="QC" selected="">Québec
                    </option><option id="SK" value="SK">Saskatchewan
                    </option><option id="YK" value="YK">Yukon
                    </option>
                  </select>
                  <div class="invalid-feedback">
                    Please select a valid province.
                  </div>
                </div>
                <div class="col-md-1">
                  <!-- postal_code -->
                  <label for="addressPostalCode" class="form-label" id="addressPostalCodeLabel">Postal code</label>
                  <input type="text" class="form-control" id="addressPostalCode" required="" value="">
                  <div class="invalid-feedback">
                    Please provide a valid postal code.
                  </div>
                </div>
              </div>
              <div class="row justify-content-left" style="padding: 8px 0px 0px 0px; margin: 0px;">
                <!-- contact section -->
                <div class="col-md-2">
                  <!-- contact_name -->
                  <label for="contactName" class="form-label" id="contactNameLabel">Contact name</label>
                  <input type="text" class="form-control" id="contactName" value="" required="">
                </div>
                <div class="col-md-3">
                  <!-- contact_title -->
                  <label for="contactTitle" class="form-label" id="contactTitleLabel">Contact title</label>
                  <input type="text" class="form-control" id="contactTitle" value="Program and services coordinator" required="">
                </div>
                <div class="col-md-4">
                  <!-- contact_email -->
                  <label for="contactEmail" class="form-label" id="contactEmailLabel">Contact email</label>
                  <div class="input-group has-validation">
                    <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-envelope"></i></span>
                    <input type="text" class="form-control" id="contactEmail" value="" aria-describedby="inputGroupPrepend" required="">
                  </div>
                </div>
                <div class="col-md-2">
                  <!-- contact_phone -->
                  <label for="" class="form-label" id="contactPhoneLabel">Contact phone</label>
                  <div class="input-group has-validation">
                    <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-telephone"></i></span>
                    <input type="text" class="form-control" id="contactPhone" value="" aria-describedby="inputGroupPrepend" required="">
                  </div>
                </div>
              </div>
              <div class="row" style="padding: 6px 0px 0px 0px; margin: 0px;">
                <!-- installation section -->
                <div class="col-md-2">
                  <!-- installers -->
                  <select class="form-select" id="installers" value="Sean Glover" required="" style="min-height: 45px;">
                    <option id="installersLabel">Choose an installer
                    </option><option id="SG" value="SG" selected="">Sean Glover
                    </option><option id="JB" value="JB">John Bird
                    </option><option id="JK" value="JK">Joel Krikorian
                    </option><option id="RE" value="RE">Rick Enright
                    </option><option id="RO" value="RO">Roberto
                    </option>
                  </select>
                  <div class="invalid-feedback">
                    Please select a valid province.
                  </div>
                </div>
                <div class="col-md-2">
                  <!-- installation_types -->
                  <div class="input-group">
                    <span class="input-group-text">Call type</span>
                    <select class="form-select" id="jobTypes" value="Installation" required="" style="min-height: 45px;">
                      <option selected="" disabled="">Types
                      </option><option value="I" id="type_install" selected="">Installation
                      </option><option value="W" id="type_warranty">Warranty
                      </option><option value="S" id="type_service">Service
                    </option></select>
                  </div>
                </div>
                <div class="col-md-2">
                  <!-- status_checkbox -->
                  <div class="input-group col-3">
                    <div class="input-group-text">
                      <input class="form-check-input mt-0" type="checkbox" id="checkComplete" value="" aria-label="Checkbox for following text input">
                    </div>
                    <input type="text" class="form-control" aria-label="Text input with checkbox" id="checkCompleteLabel" value="Check if complete">
                  </div>
                </div>
                <div class="col-lg-3 col-sm-6">
                  <!-- start_date -->
                  <div class="input-group">
                    <span class="input-group-text" id="startDateLabel">Start</span>
                    <input id="startDate" name="startDate" class="form-control" type="date" value="">
                  </div>
                </div>
                <div class="col-lg-2 col-sm-6">
                  <!-- end_date -->
                  <div class="input-group">
                    <span class="input-group-text" id="endDateLabel">End</span>
                    <input id="endDate" name="endDate" class="form-control" type="date" value="">
                  </div>
                </div>
              </div>
        
              <li class="flex-fill list-group-item" style="text-align: center; background-color: #4267B2; color: white; margin: 0px 0px 0px 0px;">Serialized products</li>
              <ul class="list-group list-group-horizontal" style="margin: 1px;">
                <li class="flex-fill list-group-item" id="r1c1_serial"></li>
                <li class="flex-fill list-group-item" id="r1c2_serial"></li>
                <li class="flex-fill list-group-item" id="r1c3_serial"></li>
              </ul>
              <ul class="list-group list-group-horizontal" style="margin: 1px;">
                <li class="flex-fill list-group-item" id="r2c1_serial"></li>
                <li class="flex-fill list-group-item" id="r2c2_serial"></li>
                <li class="flex-fill list-group-item" id="r2c3_serial"></li>
              </ul>
              <ul class="list-group list-group-horizontal" style="margin: 1px;">
                <li class="flex-fill list-group-item" id="r3c1_serial"></li>
                <li class="flex-fill list-group-item" id="r3c2_serial"></li>
                <li class="flex-fill list-group-item" id="r3c3_serial"></li>
              </ul>
              <ul class="list-group list-group-horizontal" style="margin: 1px;">
                <li class="flex-fill list-group-item" id="r4c1_serial"></li>
                <li class="flex-fill list-group-item" id="r4c2_serial"></li>
                <li class="flex-fill list-group-item" id="r4c3_serial"></li>
              </ul>
              <ul class="list-group list-group-horizontal" style="margin: 1px;">
                <li class="flex-fill list-group-item" id="r5c1_serial"></li>
                <li class="flex-fill list-group-item" id="r5c2_serial"></li>
                <li class="flex-fill list-group-item" id="r5c3_serial"></li>
              </ul>
              <li class="flex-fill list-group-item" style="text-align: center; background-color: #dcdcdc; color: black; margin: 0px 0px 0px 0px;">Trained products</li>
              <ul class="list-group list-group-horizontal" style="margin: 1px;">
                <li class="flex-fill list-group-item" id="r1c1_trained"></li>
                <li class="flex-fill list-group-item" id="r1c2_trained"></li>
                <li class="flex-fill list-group-item" id="r1c3_trained"></li>
              </ul>
              <ul class="list-group list-group-horizontal" style="margin: 1px;">
                <li class="flex-fill list-group-item" id="r2c1_trained"></li>
                <li class="flex-fill list-group-item" id="r2c2_trained"></li>
                <li class="flex-fill list-group-item" id="r2c3_trained"></li>
              </ul>
              <ul class="list-group list-group-horizontal" style="margin: 1px;">
                <li class="flex-fill list-group-item" id="r3c1_trained"></li>
                <li class="flex-fill list-group-item" id="r3c2_trained"></li>
                <li class="flex-fill list-group-item" id="r3c3_trained"></li>
              </ul>
              <ul class="list-group list-group-horizontal" style="margin: 1px;">
                <li class="flex-fill list-group-item" id="r4c1_trained"></li>
                <li class="flex-fill list-group-item" id="r4c2_trained"></li>
                <li class="flex-fill list-group-item" id="r4c3_trained"></li>
              </ul>
              <ul class="list-group list-group-horizontal" style="margin: 1px;">
                <li class="flex-fill list-group-item" id="r5c1_trained"></li>
                <li class="flex-fill list-group-item" id="r5c2_trained"></li>
                <li class="flex-fill list-group-item" id="r5c3_trained"></li>
              </ul>
                <!-- trained staff names - comma separated -->
              <li class="flex-fill list-group-item" style="text-align: center; background-color: #E6E6FA; color: black; margin: 0px 0px 0px 0px;">Trained staff
              </li>
              <ul class="list-group list-group-horizontal" style="margin: 1px;">
                <li class="flex-fill list-group-item" id="r1c1_trainedStaff" style="min-height: 40px;">monkey</li>
              </ul>

              <div class="form-floating" style="padding: 3px; margin-top: 10px;">
                <!-- comments -->
                <textarea class="form-control" placeholder="Leave a comment here" id="comments" oninput="auto_grow(this)"></textarea>
                <label for="comments" style="color: CornflowerBlue; font-weight: bold;">Comments</label>
              </div>
              <div class="form-floating" style="padding: 3px;">
                <!-- issues -->
                <textarea class="form-control" placeholder="Leave a comment here" id="issues" oninput="auto_grow(this)" value=""></textarea>
                <label for="issues" style="color: CornflowerBlue; font-weight: bold;">Issues</label>
              </div>
              <div class="form-floating" style="padding: 3px;">
                <!-- client comments -->
                <textarea class="form-control" name="clientComments" placeholder="Leave a comment here" id="clientComments" oninput="auto_grow(this)"></textarea>
                <label for="clientComments" style="color: CornflowerBlue; font-weight: bold;">Client comments</label>
              </div>
        
              <div class="row" style="padding: 6px 0px 0px 0px; margin: 0px;">
                <div class="col-md-9">
                  <!-- client_signature -->
                  <div class="input-group has-validation">
                    <span class="input-group-text" id="clientSignatureLabel">Client signature</span>
                    <input type="text" class="form-control" name="signedBy" id="clientSignature" value="" aria-describedby="inputGroupPrepend" required="" placeholder="Type your name">
                  </div>
                </div>
                <div class="col-lg-3 col-sm-6">
                  <!-- sign_date -->
                  <div class="input-group">
                    <span class="input-group-text" id="signDateLabel">Dated</span>
                    <input id="signDate" class="form-control" type="date" value="">
                  </div>
                </div>
              </div>
        
              <div class="container d-flex justify-content-center align-items-center">
                <div class="card h-100 p-3">
                  <!-- readonly stars (25px) -->
                  <table id="starsOverall" style="font-size: x-large">
                    <tr>
                      <td style="align-items: center;">
                        <td><img src="images/starEmpty.png" id="1-overall" width="25" height="25"></td>
                        <td><img src="images/starEmpty.png" id="2-overall" width="25" height="25"></td>
                        <td><img src="images/starEmpty.png" id="3-overall" width="25" height="25"></td>
                        <td><img src="images/starEmpty.png" id="4-overall" width="25" height="25"></td>
                        <td><img src="images/starEmpty.png" id="5-overall" width="25" height="25"></td>
                      </td>
                      <td style="text-align: center; font-weight: bolder;">
                        Overall rating
                      </td>
                    </tr>
                  </table>
                  <!-- clickable stars (20px) -->
                  <table id="starsByCategory" style="font-size: larger;">
                    <tr>
                      <td>Installer professional</td>
                      <td>
                        <td><img src="images/starEmpty.png" id="1-professional" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="2-professional" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="3-professional" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="4-professional" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="5-professional" width="20" height="20"></td>
                      </td>
                    </tr>
                    <tr>
                      <td>Installer promptness</td>
                      <td>
                        <td><img src="images/starEmpty.png" id="1-prompt" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="2-prompt" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="3-prompt" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="4-prompt" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="5-prompt" width="20" height="20"></td>
                      </td>
                    </tr>
                    <tr>
                      <td>Installer workmanship</td>
                      <td>
                        <td><img src="images/starEmpty.png" id="1-workmanship" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="2-workmanship" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="3-workmanship" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="4-workmanship" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="5-workmanship" width="20" height="20"></td>
                      </td>
                    </tr>
                    <tr>
                      <td>Product quality</td>
                      <td>
                        <td><img src="images/starEmpty.png" id="1-quality" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="2-quality" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="3-quality" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="4-quality" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="5-quality" width="20" height="20"></td>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <input style="max-height: 36px; font-size:large" type="text" class="form-control" name="starsOther" id="starsOtherInput" aria-describedby="inputGroupPrepend" placeholder="Optional input - type your criteria">
                      </td>
                      <td>
                        <td><img src="images/starEmpty.png" id="1-other" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="2-other" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="3-other" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="4-other" width="20" height="20"></td>
                        <td><img src="images/starEmpty.png" id="5-other" width="20" height="20"></td>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
        
              <div class="col-12">
                <!-- terms_checkbox -->
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="agreeTermsCheck" required="">
                  <label class="form-check-label" for="agreeTermsCheck">
                    Agree to terms and conditions
                  </label>
                  <div class="invalid-feedback">
                    You must agree before submitting.
                  </div>
                </div>
              </div>
              <div class="col-12" style="padding-bottom: 10px;">
                <div class="row" style="color: red; font-weight: bolder; padding: 6px 0px 0px 0px; margin: 0px; display: none;" id="submitWarning">
                  xxx
                </div>
                <!-- submit_form -- change type="button" back to type="submit" -->
                <button class="button-success pure-button button-xlarge" type="button" style="background-color: #55acee; padding: 10px 30px 10px 30px;" id="submitForm">
                  <div class="row" style="padding: 6px 0px 0px 0px; margin: 0px;">
                    <div class="col-lg-3 col-sm-3">
                      <i class="fa fa-paper-plane"></i>
                    </div>
                    <div class="col-lg-6 col-sm-6">
                      Submit
                    </div>
                  </div>
                </button>
              </div>
        
              <input class="honeypot-field" id="starsProf_" type="text" name="professional" value="">
              <input class="honeypot-field" id="starsPrompt_" type="text" name="prompt" value="">
              <input class="honeypot-field" id="starsWork_" type="text" name="workmanship" value="">
              <input class="honeypot-field" id="starsQuality_" type="text" name="quality" value="">
              <input class="honeypot-field" id="serials" type="text" name="serials" value="">
        
              <fieldset class="pure-group honeypot-field">
                <label for="honeypot">To help avoid spam, use a Honeypot technique with a hidden text field; must be empty to submit the form! Otherwise, we assume the user is a spam bot.</label>
                <input id="honeypot" type="text" name="honeypot" value="">
              </fieldset>
            </form>
            <form id="thankYouMessage" style="display: none">
              <div class="jumbotron text-center">
                <h1 class="display-3">Thank You!</h1>
                <p class="lead" id="appreciateIt"><strong>We have received your submission.</strong> We'll take it from here!</p>
                <hr>
                <button class="pure-button button-medium" style="padding: 10px 30px 10px 30px;" id="reload" onclick="window.location.reload();">
                  <i class="fa fa-arrow-left"></i>
                  &nbsp;Return to original form
                </button>
                <p>
                  Visit us!
                  <a href="https://www.flaghouse.ca/">Continue to homepage</a>
                </p>
              </div>
              <footer class="site-footer" id="footer">
                <p class="site-footer__fineprint" id="fineprint">FlagHouse, Inc. | 50 East Wilmot Street, Suite 201 | Richmond Hill, ON L4B 3Z3 | Copyright ©2005 - 2023, All Rights Reserved</p>
              </footer>
            </form>
          </div>
        </details>

      </section>

    </div>
    <script>
      $(document).ready(function() {
        // document.getElementById('checkComplete').click();
        document.getElementById('agreeTermsCheck').click();
        var txts = document.getElementsByTagName('TEXTAREA');
        for (var i = 0, l = txts.length; i < l; i++) {
          auto_grow(txts[i]);
        };
        // can't get jquery to find the element? but document.getElementById does
        // ... maybe because jquery doesn't kick in right away- even after document load
        // the star img functionality is all jquery which does work but a user would only click many seconds after load
        var date = new Date();
        var day = date.getDate();
        var month = date.getMonth() + 1;
        var year = date.getFullYear();
        if (month < 10) month = "0" + month;
        if (day < 10) day = "0" + day;
        var today = year + "-" + month + "-" + day;
        document.getElementById('signDate').value = today;
      });
      $('body').on('click','img',function(e){
        if (!this.id.endsWith('overall')) {
          var clickedStar = this; // Save reference
          var clickedAncestorDetails = clickedStar.closest('details');

          var clickedIndex = parseInt(clickedStar.id.substr(0, 1));
          var childIndex = 1;
          var starLeft = clickedStar.getBoundingClientRect().left;
          var starWidth = clickedStar.getBoundingClientRect().width;
          var starMid = starLeft + (starWidth / 2);
          var clickedLofCenter = e.pageX < starMid;
          var starSrc = clickedStar.getAttribute('src');
          var lvlsPath = starSrc.split('/');
          var ehfBefore = lvlsPath[lvlsPath.length - 1].split('.')[0].replace('star', '');

          var clickedRow = clickedStar.closest("tr");
          var siblings = clickedRow.getElementsByTagName('img');
          // toggle the last star to empty when half or full
          var ehfAfter = clickedLofCenter ? 'Half' : 'Fill';
          var ehf = ehfBefore == ehfAfter ? 'Empty' : ehfAfter;
          fillStars(siblings, clickedIndex, ehf);

          // now sum up the total value of stars to calculate the overall value
          // must go up the chain vs getelementbyid as template has the same ids!

          var starsCard = clickedStar.closest('div.card');
          var allStars20 = starsCard.querySelectorAll("img[height='20']");
          var sumStars = 0;
          for (var i = 0; i < allStars20.length; i++) {
          var star20 = allStars20[i];
          var ehf = star20.getAttribute('src').split('/')[1].split('.')[0].replace('star', '');
          var starValue = ehf == 'Fill' ? 1 : ehf == 'Half' ? .5 : 0;
          sumStars += starValue;
          }
          
          // now get an average to display in the overall section
          // 4 is the # of categories, but using a variable to get the count
          var categoryCount = allStars20.length / 5; // will always be 5 star range
          var avgOverall = roundNumber(sumStars / categoryCount, 1);
          var floor = Math.floor(avgOverall);
          var ceiling = Math.ceil(avgOverall);
          var decimalPart = roundNumber(avgOverall - floor, 1);
          // console.log(`sum ${sumStars}; avg ${avgOverall}; floor ${floor}; ceiling ${ceiling} decimal ${decimalPart}`);
          ehf = floor == ceiling | decimalPart > .9 ? 'Fill' : decimalPart < 1/3 ? 'Empty' : 'Half';

          var allStars25 = starsCard.querySelectorAll("img[height='25']");
          fillStars(allStars25, Math.ceil(avgOverall), ehf);

          var ratingLabel = starsCard.querySelector("#overallRatingLabel");
          // var frenchOrEnglish = $.trim(regexMatch(ratingLabel, /[a-z ]{1,}/gi));
          // $("#overallRatingLabel").html(frenchOrEnglish + ' ' + overall);            
        }
      });
      function auto_grow(element)
      {
        if(element.clientHeight < element.scrollHeight) {
          element.style.height = `${element.scrollHeight}px`;
        }
      }
      function regexMatch(input, pattern)
      {
        let text = input.toString();
        return text.match(pattern);
      }
      function roundHalf(x)
      {
          return Math.ceil(x/.5)*.5;
      }
      function roundNumber(num, scale) {
        if(!("" + num).includes("e")) {
          return +(Math.round(num + "e+" + scale)  + "e-" + scale);
        } else {
          var arr = ("" + num).split("e");
          var sig = ""
          if(+arr[1] + scale > 0) {
            sig = "+";
          }
          return +(Math.round(+arr[0] + "e" + sig + (+arr[1] + scale)) + "e-" + scale);
        }
      }
      function countStars(element) {

        var children = element.children;
        var starTotal = 0;
        for (var i = 0; i < children.length; i++) {
          var starChild = children[i];
          var ehf = starChild.getAttribute('src').split('/')[1].split('.')[0].replace('star', '');
          var starValue = ehf == 'Fill' ? 1 : ehf == 'Half' ? .5 : 0;
          starTotal += starValue;
        }
        return starTotal;

      }
      function fillStars(siblings, clickedIndex, ehf) {
          // set all stars to empty
          for (var i = 0; i < siblings.length; i++) {
            var sibling = siblings[i];
            sibling.setAttribute('src', 'images/starEmpty.png');
          }
          // fill in the stars as half or full                    
          for (var i = 0; i < clickedIndex - 1; i++) {
            sibling = siblings[i];
            sibling.setAttribute('src', 'images/starFill.png');
          }
          // set the last star to half or full
          siblings[clickedIndex - 1].setAttribute('src', `images/star${ehf}.png`);
      }
      function formSubmitted(e) {
        const serials = [];
        var serialIds = document.querySelectorAll("[id$=_serial]")
        serialIds.forEach(s => {
          serials.push(s.innerText);
        });
        var serialsJoined = serials.join("|");
        document.getElementById('serials').value = serialsJoined;
        var submitImg = document.getElementById('submitImg');
        submitImg.className = "fa fa-check";
        var receivedFeedback = document.getElementById('clientComments').value.length > 0;
        if (!receivedFeedback) {
          var starsClicked = document.querySelectorAll("[id^=stars][id$=_]");
          starsClicked.forEach(s => {
            if (s.value.length > 0) receivedFeedback = true;
          });
        }
        if(receivedFeedback) {
          var appreciateIt = document.getElementById('appreciateIt');
          appreciateIt.innerText += ' PS Thanks so much for the feedback : )';
        }
        document.getElementById('mainForm').style.display = "none";
        document.getElementById('thankYouMessage').style.display = "block";
      }
    </script>
  </body>
</html>